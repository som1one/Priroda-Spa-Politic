# ะะฐะบ ัะฐะฑะพัะฐะตั ะทะฐะฟะธัั ัะตัะตะท YClients - ะะพะดัะพะฑะฝะพะต ะพะฑัััะฝะตะฝะธะต

## ๐ ะขะตะบััะฐั ัะตะฐะปะธะทะฐัะธั

ะะฐ, ะฒั ะฟัะฐะฒั! **ะกะตะนัะฐั ะทะฐะฟะธัั ัะฐะฑะพัะฐะตั ัะตัะตะท ะพัะบัััะธะต ัััะปะบะธ ั ัะพัะผะพะน YClients**. ะะพั ะบะฐะบ ััะพ ััััะพะตะฝะพ:

## ๐ ะัะพัะตัั ะทะฐะฟะธัะธ (ะฟะพัะฐะณะพะฒะพ)

### 1. ะะพะปัะทะพะฒะฐัะตะปั ะฝะฐะถะธะผะฐะตั "ะะฐะฟะธัะฐัััั ะพะฝะปะฐะนะฝ"

**ะะดะต:**
- ะ ะผะตะฝั (ะบะฝะพะฟะบะฐ "ะะฐะฟะธัะฐัััั ะพะฝะปะฐะนะฝ" ะฒ ัะตะบัะธะธ ะทะฐะฟะธัะธ)
- ะะฐ ัััะฐะฝะธัะต ััะปัะณะธ (ะตัะปะธ ััะปัะณะฐ ะฟัะธะฒัะทะฐะฝะฐ ะบ YClients)

**ะงัะพ ะฟัะพะธััะพะดะธั:**
- ะัะบััะฒะฐะตััั ัะบัะฐะฝ `YClientsBookingScreen`
- Flutter ะดะตะปะฐะตั ะทะฐะฟัะพั ะบ ะฑัะบะตะฝะดั: `GET /api/v1/yclients/widget-url/{service_id}`
- ะัะปะธ `service_id = 0` โ ะพะฑัะฐั ัะพัะผะฐ ะทะฐะฟะธัะธ (ะฒัะฑะพั ััะปัะณะธ ะฒ ัะพัะผะต)
- ะัะปะธ `service_id > 0` โ ัะพัะผะฐ ั ะฟัะตะดะฒัะฑัะฐะฝะฝะพะน ััะปัะณะพะน

### 2. ะัะบะตะฝะด ัะพัะผะธััะตั URL ัะพัะผั YClients

**Endpoint:** `GET /api/v1/yclients/widget-url/{service_id}`

**ะงัะพ ะดะตะปะฐะตั ะฑัะบะตะฝะด:**

1. **ะัะพะฒะตััะตั ะฝะฐัััะพะนะบะธ:**
   - `YCLIENTS_ENABLED` - ะฒะบะปััะตะฝะฐ ะปะธ ะธะฝัะตะณัะฐัะธั
   - `YCLIENTS_BOOKING_FORM_URL` - ะตััั ะปะธ ะฝะฐัััะพะตะฝะฝะฐั ัะพัะผะฐ
   - `YCLIENTS_COMPANY_ID` - ID ะบะพะผะฟะฐะฝะธะธ ะฒ YClients

2. **ะคะพัะผะธััะตั ะฑะฐะทะพะฒัะน URL:**
   ```python
   # ะัะปะธ ัะบะฐะทะฐะฝ YCLIENTS_BOOKING_FORM_URL
   widget_url = "https://n239661.yclients.com"
   
   # ะะปะธ ััะฐะฝะดะฐััะฝัะน ะฒะธะดะถะตั
   widget_url = f"https://yclients.com/timetable/{COMPANY_ID}"
   ```

3. **ะะพะฑะฐะฒะปัะตั ะฟะฐัะฐะผะตััั:**
   - `services={service_id}` - ะตัะปะธ ััะปัะณะฐ ัะบะฐะทะฐะฝะฐ
   - `staff={staff_id}` - ะตัะปะธ ะผะฐััะตั ัะบะฐะทะฐะฝ
   - `client_name={ะธะผั}` - ะฟัะตะดะทะฐะฟะพะปะฝะตะฝะธะต ะธะผะตะฝะธ
   - `client_email={email}` - ะฟัะตะดะทะฐะฟะพะปะฝะตะฝะธะต email
   - `client_phone={ัะตะปะตัะพะฝ}` - ะฟัะตะดะทะฐะฟะพะปะฝะตะฝะธะต ัะตะปะตัะพะฝะฐ
   - `comment={ะบะพะด}` - **ัะฝะธะบะฐะปัะฝัะน ะบะพะด ะฟะพะปัะทะพะฒะฐัะตะปั** (ะฒะฐะถะฝะพ!)

4. **ะะพะฑะฐะฒะปัะตั ัะฝะธะบะฐะปัะฝัะน ะบะพะด ะฒ ะบะพะผะผะตะฝัะฐัะธะน:**
   ```python
   if current_user.unique_code:
       comment_param = f"ะะพะด ะบะปะธะตะฝัะฐ: {current_user.unique_code}"
       params.append(f"comment={quote(comment_param)}")
   ```

**ะัะธะผะตั ะธัะพะณะพะฒะพะณะพ URL:**
```
https://n239661.yclients.com/?services=17036299&client_name=ะะฒะฐะฝ%20ะะฒะฐะฝะพะฒ&client_email=ivan@example.com&client_phone=%2B79991234567&comment=ะะพะด%20ะบะปะธะตะฝัะฐ%3A%20ABC12345
```

### 3. Flutter ะพัะบััะฒะฐะตั WebView ั ัะพัะผะพะน

**ะงัะพ ะฟัะพะธััะพะดะธั:**
- Flutter ะฟะพะปััะฐะตั `widget_url` ะพั ะฑัะบะตะฝะดะฐ
- ะกะพะทะดะฐะตััั `WebViewController`
- ะะฐะณััะถะฐะตััั URL ะฒ `WebView`
- ะะพะปัะทะพะฒะฐัะตะปั ะฒะธะดะธั ัะพัะผั YClients ะฟััะผะพ ะฒ ะฟัะธะปะพะถะตะฝะธะธ

**ะัะพะฑะตะฝะฝะพััะธ:**
- ะคะพัะผะฐ ะฟัะตะดะทะฐะฟะพะปะฝะตะฝะฐ ะดะฐะฝะฝัะผะธ ะฟะพะปัะทะพะฒะฐัะตะปั (ะธะผั, email, ัะตะปะตัะพะฝ)
- ะัะปะธ ััะปัะณะฐ ัะบะฐะทะฐะฝะฐ - ะพะฝะฐ ัะถะต ะฒัะฑัะฐะฝะฐ
- ะัะปะธ ะผะฐััะตั ัะบะฐะทะฐะฝ - ะพะฝ ัะถะต ะฒัะฑัะฐะฝ
- ะ ะบะพะผะผะตะฝัะฐัะธะธ ะฐะฒัะพะผะฐัะธัะตัะบะธ ะดะพะฑะฐะฒะปะตะฝ ะบะพะด: `"ะะพะด ะบะปะธะตะฝัะฐ: ABC12345"`

### 4. ะะพะปัะทะพะฒะฐัะตะปั ะทะฐะฟะพะปะฝัะตั ัะพัะผั ะธ ัะพะทะดะฐะตั ะทะฐะฟะธัั

**ะงัะพ ะดะตะปะฐะตั ะฟะพะปัะทะพะฒะฐัะตะปั:**
- ะัะฑะธัะฐะตั ะดะฐัั ะธ ะฒัะตะผั (ะตัะปะธ ะฝะต ะฒัะฑัะฐะฝั)
- ะัะพะฒะตััะตั/ัะตะดะฐะบัะธััะตั ะดะฐะฝะฝัะต
- ะะฐะถะธะผะฐะตั "ะะฐะฟะธัะฐัััั"

**ะงัะพ ะฟัะพะธััะพะดะธั ะฒ YClients:**
- ะะฐะฟะธัั ัะพะทะดะฐะตััั ะฒ ัะธััะตะผะต YClients
- ะ ะบะพะผะผะตะฝัะฐัะธะธ ะทะฐะฟะธัะธ ัะพััะฐะฝัะตััั: `"ะะพะด ะบะปะธะตะฝัะฐ: ABC12345"`
- YClients ะพัะฟัะฐะฒะปัะตั webhook ะฝะฐ ะฝะฐั ัะตัะฒะตั (ะตัะปะธ ะฝะฐัััะพะตะฝ)

### 5. ะะฟัะตะดะตะปะตะฝะธะต ััะฟะตัะฝะพะน ะทะฐะฟะธัะธ

**ะะฐะบ Flutter ะฟะพะฝะธะผะฐะตั, ััะพ ะทะฐะฟะธัั ัะพะทะดะฐะฝะฐ:**

1. **ะะพะฝะธัะพัะธะฝะณ URL ะฒ WebView:**
   ```dart
   onUrlChange: (UrlChange change) {
     _checkForBookingSuccess(change.url!);
   }
   ```

2. **ะัะพะฒะตัะบะฐ ะฟัะธะทะฝะฐะบะพะฒ ััะฟะตัะฐ:**
   - URL ัะพะดะตัะถะธั `success`
   - URL ัะพะดะตัะถะธั `confirmed`
   - URL ัะพะดะตัะถะธั `record_id=`
   - URL ัะพะดะตัะถะธั `booking_id=`
   - URL ัะพะดะตัะถะธั `date=` ะธ `time=`

3. **ะะพะบะฐะท ะดะธะฐะปะพะณะฐ ััะฟะตัะฐ:**
   - "ะั ะทะฐะฟะธัะฐะฝั!"
   - ะะฝะพะฟะบะฐ "ะัะปะธัะฝะพ" ะธะปะธ "ะะพัะผะพััะตัั ะทะฐะฟะธัะธ"

### 6. ะกะธะฝััะพะฝะธะทะฐัะธั ะทะฐะฟะธัะธ ั ะฝะฐัะตะน ะะ

**ะะฒะฐ ัะฟะพัะพะฑะฐ ัะธะฝััะพะฝะธะทะฐัะธะธ:**

#### ะกะฟะพัะพะฑ 1: Webhook (ะผะณะฝะพะฒะตะฝะฝะพ)
- YClients ะพัะฟัะฐะฒะปัะตั POST ะทะฐะฟัะพั ะฝะฐ `/api/v1/yclients/webhook`
- ะัะบะตะฝะด ะฟะพะปััะฐะตั ะดะฐะฝะฝัะต ะทะฐะฟะธัะธ
- ะัะตั ะฟะพะปัะทะพะฒะฐัะตะปั ะฟะพ ะบะพะดั ะธะท ะบะพะผะผะตะฝัะฐัะธั
- ะกะพะทะดะฐะตั ะทะฐะฟะธัั ะฒ ะฝะฐัะตะน ะะ
- ะะฐัะธัะปัะตั ะฑะพะฝััั (ะตัะปะธ ะทะฐะฟะธัั ะทะฐะฒะตััะตะฝะฐ)

#### ะกะฟะพัะพะฑ 2: ะะตัะธะพะดะธัะตัะบะฐั ัะธะฝััะพะฝะธะทะฐัะธั (ะบะฐะถะดัะต 30 ะผะธะฝัั)
- ะัะบะตะฝะด ะฐะฒัะพะผะฐัะธัะตัะบะธ ะทะฐะฟัะฐัะธะฒะฐะตั ะทะฐะฟะธัะธ ะธะท YClients
- ะะพะปััะฐะตั ะฒัะต ะทะฐะฟะธัะธ ะทะฐ ะฟะพัะปะตะดะฝะธะต 30 ะดะฝะตะน
- ะัะตั ะฟะพะปัะทะพะฒะฐัะตะปะตะน ะฟะพ ะบะพะดั/email/ัะตะปะตัะพะฝั
- ะกะพะทะดะฐะตั/ะพะฑะฝะพะฒะปัะตั ะทะฐะฟะธัะธ ะฒ ะะ
- ะะฐัะธัะปัะตั ะฑะพะฝััั ะทะฐ ะทะฐะฒะตััะตะฝะฝัะต ะทะฐะฟะธัะธ

## ๐ ะกัะตะผะฐ ัะฐะฑะพัั

```
โโโโโโโโโโโโโโโ
โ  ะะพะปัะทะพะฒะฐัะตะปัโ
โ  ะฝะฐะถะธะผะฐะตั   โ
โ "ะะฐะฟะธัะฐัััั"โ
โโโโโโโโฌโโโโโโโโ
       โ
       โผ
โโโโโโโโโโโโโโโโโโโโโโโ
โ Flutter App         โ
โ GET /widget-url/0   โ
โโโโโโโโฌโโโโโโโโโโโโโโโ
       โ
       โผ
โโโโโโโโโโโโโโโโโโโโโโโ
โ Backend             โ
โ ะคะพัะผะธััะตั URL ั:    โ
โ - ะะฐะฝะฝัะผะธ ะฟะพะปัะทะพะฒะฐัะตะปัโ
โ - ะฃะฝะธะบะฐะปัะฝัะผ ะบะพะดะพะผ  โ
โ - ะฃัะปัะณะพะน (ะตัะปะธ ะตััั)โ
โโโโโโโโฌโโโโโโโโโโโโโโโ
       โ
       โผ
โโโโโโโโโโโโโโโโโโโโโโโ
โ WebView              โ
โ ะัะบััะฒะฐะตั ัะพัะผั      โ
โ YClients             โ
โโโโโโโโฌโโโโโโโโโโโโโโโ
       โ
       โผ
โโโโโโโโโโโโโโโโโโโโโโโ
โ ะะพะปัะทะพะฒะฐัะตะปั         โ
โ ะทะฐะฟะพะปะฝัะตั ัะพัะผั      โ
โ ะธ ัะพะทะดะฐะตั ะทะฐะฟะธัั     โ
โโโโโโโโฌโโโโโโโโโโโโโโโ
       โ
       โผ
โโโโโโโโโโโโโโโโโโโโโโโ
โ YClients             โ
โ ะกะพะทะดะฐะตั ะทะฐะฟะธัั       โ
โ ะัะฟัะฐะฒะปัะตั webhook   โ
โโโโโโโโฌโโโโโโโโโโโโโโโ
       โ
       โผ
โโโโโโโโโโโโโโโโโโโโโโโ
โ Backend              โ
โ ะะพะปััะฐะตั webhook     โ
โ ะะฐัะพะดะธั ะฟะพะปัะทะพะฒะฐัะตะปั โ
โ ะฟะพ ะบะพะดั              โ
โ ะกะพะทะดะฐะตั ะทะฐะฟะธัั ะฒ ะะ  โ
โโโโโโโโโโโโโโโโโโโโโโโ
```

## ๐ ะะปััะตะฒัะต ะผะพะผะตะฝัั

### โ ะงัะพ ัะฐะฑะพัะฐะตั ัะพัะพัะพ:

1. **ะัะตะดะทะฐะฟะพะปะฝะตะฝะธะต ะดะฐะฝะฝัั** - ะฟะพะปัะทะพะฒะฐัะตะปั ะฝะต ะฝัะถะฝะพ ะฒะฒะพะดะธัั ะธะผั, email, ัะตะปะตัะพะฝ
2. **ะฃะฝะธะบะฐะปัะฝัะน ะบะพะด ะฒ ะบะพะผะผะตะฝัะฐัะธะธ** - ะฟะพะทะฒะพะปัะตั ัะพัะฝะพ ะฟัะธะฒัะทะฐัั ะทะฐะฟะธัั ะบ ะฟะพะปัะทะพะฒะฐัะตะปั
3. **WebView ะฒ ะฟัะธะปะพะถะตะฝะธะธ** - ะฝะต ะฝัะถะฝะพ ะพัะบััะฒะฐัั ะฑัะฐัะทะตั
4. **ะะฒัะพะผะฐัะธัะตัะบะฐั ัะธะฝััะพะฝะธะทะฐัะธั** - ะทะฐะฟะธัะธ ะฟะพะฟะฐะดะฐัั ะฒ ะฝะฐัั ะะ
5. **ะะฐัะธัะปะตะฝะธะต ะฑะพะฝััะพะฒ** - ะฐะฒัะพะผะฐัะธัะตัะบะธ ะฟัะธ ะทะฐะฒะตััะตะฝะธะธ ะทะฐะฟะธัะธ

### โ๏ธ ะะณัะฐะฝะธัะตะฝะธั:

1. **ะะฐะฒะธัะธะผะพััั ะพั YClients** - ะตัะปะธ YClients ะฝะตะดะพัััะฟะตะฝ, ะทะฐะฟะธัั ะฝะต ัะฐะฑะพัะฐะตั
2. **Webhook ะฝะต ะพะฑัะทะฐัะตะปะตะฝ** - ะผะพะถะฝะพ ัะฐะฑะพัะฐัั ัะพะปัะบะพ ั ะฟะตัะธะพะดะธัะตัะบะพะน ัะธะฝััะพะฝะธะทะฐัะธะตะน
3. **ะะฟัะตะดะตะปะตะฝะธะต ััะฟะตัะฐ ะฟะพ URL** - ะฝะต ะฒัะตะณะดะฐ ะฝะฐะดะตะถะฝะพ (ะทะฐะฒะธัะธั ะพั YClients)
4. **ะะตั ะฟััะผะพะณะพ API ัะพะทะดะฐะฝะธั** - ะธัะฟะพะปัะทัะตััั ัะพัะผะฐ YClients, ะฐ ะฝะต API

## ๐ฏ ะัะพะณะพ

**ะะฐ, ะฒั ะฟัะฐะฒั!** ะกะตะนัะฐั ะทะฐะฟะธัั ัะฐะฑะพัะฐะตั ัะฐะบ:
1. ะัะบััะฒะฐะตััั ัััะปะบะฐ ั ัะพัะผะพะน YClients
2. ะคะพัะผะฐ ะฟัะตะดะทะฐะฟะพะปะฝะตะฝะฐ ะดะฐะฝะฝัะผะธ ะฟะพะปัะทะพะฒะฐัะตะปั
3. ะ ะบะพะผะผะตะฝัะฐัะธะธ ะฐะฒัะพะผะฐัะธัะตัะบะธ ะดะพะฑะฐะฒะปะตะฝ ัะฝะธะบะฐะปัะฝัะน ะบะพะด
4. ะะพะปัะทะพะฒะฐัะตะปั ะทะฐะฟะพะปะฝัะตั ัะพัะผั ะธ ัะพะทะดะฐะตั ะทะฐะฟะธัั
5. ะะฐะฟะธัั ัะธะฝััะพะฝะธะทะธััะตััั ั ะฝะฐัะตะน ะะ ัะตัะตะท webhook ะธะปะธ ะฟะตัะธะพะดะธัะตัะบัั ัะธะฝััะพะฝะธะทะฐัะธั

ะญัะพ ะฟัะพััะพะต ะธ ะฝะฐะดะตะถะฝะพะต ัะตัะตะฝะธะต, ะบะพัะพัะพะต ะธัะฟะพะปัะทัะตั ะณะพัะพะฒัั ัะพัะผั YClients ะฑะตะท ะฝะตะพะฑัะพะดะธะผะพััะธ ัะพะทะดะฐะฒะฐัั ัะฒะพั ัะธััะตะผั ะฑัะพะฝะธัะพะฒะฐะฝะธั.


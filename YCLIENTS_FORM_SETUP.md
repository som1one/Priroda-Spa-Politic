# Настройка записи через формы YClients

## Что это дает?

Вместо использования стандартного виджета YClients, можно использовать прямые ссылки на ваши формы онлайн-записи. Это позволяет:
- Использовать настроенные формы из YClients
- Сохранить все настройки форм (дизайн, поля, правила)
- Использовать разные формы для компании и сети

## Настройка

### 1. Получите URL ваших форм

В YClients перейдите в раздел "Онлайн-запись" и скопируйте URL ваших форм:
- **Форма компании**: `https://n239661.yclients.com`
- **Форма сети**: `https://n328197.yclients.com` (опционально)

### 2. Добавьте в `backend/.env`

```env
# URL формы для онлайн-записи
YCLIENTS_BOOKING_FORM_URL=https://n239661.yclients.com

# URL формы сети (опционально, если есть несколько филиалов)
YCLIENTS_NETWORK_FORM_URL=https://n328197.yclients.com
```

### 3. Перезапустите бэкенд

После изменения `.env` перезапустите бэкенд, чтобы настройки применились.

## Как это работает

1. Когда пользователь выбирает услугу и нажимает "Записаться", приложение запрашивает URL формы у бэкенда
2. Бэкенд проверяет, указан ли `YCLIENTS_BOOKING_FORM_URL`:
   - **Если указан**: используется прямая ссылка на форму
   - **Если не указан**: используется стандартный виджет YClients

3. В URL формы автоматически добавляются параметры:
   - `services=ID` - если услуга привязана к YClients
   - `staff=ID` - если указан мастер
   - `client_name=...` - имя пользователя (если авторизован)
   - `client_email=...` - email пользователя (если авторизован)
   - `client_phone=...` - телефон пользователя (если авторизован)

## Примеры URL

### С услугой и мастером:
```
https://n239661.yclients.com/?services=12345&staff=67890
```

### С предзаполненными данными пользователя:
```
https://n239661.yclients.com/?services=12345&client_name=Иван%20Иванов&client_email=ivan@example.com&client_phone=%2B79991234567
```

## Преимущества

✅ Используются ваши настроенные формы YClients  
✅ Сохраняются все настройки форм (дизайн, поля, правила)  
✅ Автоматическое предзаполнение данных пользователя  
✅ Поддержка разных форм для компании и сети  
✅ Работает с существующим экраном `YClientsBookingScreen`  

## Проверка

1. Убедитесь, что `YCLIENTS_BOOKING_FORM_URL` указан в `.env`
2. Перезапустите бэкенд
3. Откройте услугу в приложении и нажмите "Записаться"
4. Должна открыться ваша форма YClients с предзаполненными данными

## Если форма не открывается

1. Проверьте, что URL формы правильный (должен начинаться с `https://`)
2. Убедитесь, что форма активна в YClients
3. Проверьте логи бэкенда на наличие ошибок
4. Убедитесь, что `YCLIENTS_ENABLED=True` в `.env`


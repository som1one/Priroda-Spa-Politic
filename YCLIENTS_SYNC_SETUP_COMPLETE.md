# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –∑–∞–ø–∏—Å–µ–π –∏–∑ YClients - –ì–æ—Ç–æ–≤–æ!

## ‚úÖ –ß—Ç–æ —É–∂–µ —Å–¥–µ–ª–∞–Ω–æ

### 1. –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∫–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ `unique_code` –≤ —Ç–∞–±–ª–∏—Ü—É `users`
- ‚úÖ –ö–æ–¥ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—Ä–æ—Å–µ —Ñ–æ—Ä–º—ã –∑–∞–ø–∏—Å–∏
- ‚úÖ –ö–æ–¥ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –≤ –ø—Ä–æ—Ñ–∏–ª–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (Flutter)
- ‚úÖ –ö–æ–¥ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è –ø–æ–∏—Å–∫–∞ –≤ –∞–¥–º–∏–Ω –ø–∞–Ω–µ–ª–∏

### 2. –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∑–∞–ø–∏—Å–µ–π
- ‚úÖ Webhook endpoint: `POST /api/v1/yclients/webhook`
- ‚úÖ –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∫–∞–∂–¥—ã–µ 30 –º–∏–Ω—É—Ç
- ‚úÖ –ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ —É–Ω–∏–∫–∞–ª—å–Ω–æ–º—É –∫–æ–¥—É, email –∏–ª–∏ —Ç–µ–ª–µ—Ñ–æ–Ω—É
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å–µ–π –≤ –ë–î

### 3. –ù–∞—á–∏—Å–ª–µ–Ω–∏–µ –±–æ–Ω—É—Å–æ–≤
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –∑–∞–ø–∏—Å–∏
- ‚úÖ –£—á–µ—Ç –ø–æ—Ç—Ä–∞—á–µ–Ω–Ω—ã—Ö –±–æ–Ω—É—Å–æ–≤ (`spent_bonuses`)
- ‚úÖ –°–ø–∏—Å–∞–Ω–∏–µ –±–æ–Ω—É—Å–æ–≤ –ø–æ –∫–æ–¥—É –≤ –∞–¥–º–∏–Ω –ø–∞–Ω–µ–ª–∏

### 4. –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å
- ‚úÖ –ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ —É–Ω–∏–∫–∞–ª—å–Ω–æ–º—É –∫–æ–¥—É
- ‚úÖ –°–ø–∏—Å–∞–Ω–∏–µ –±–æ–Ω—É—Å–æ–≤ –ø–æ –∫–æ–¥—É
- ‚úÖ –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫–æ–¥–∞ –≤ —Ç–∞–±–ª–∏—Ü–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

## üìã –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –¥–∞–ª—å—à–µ

### 1. –û–±–Ω–æ–≤–∏—Ç—å –ø–æ—Ä—Ç –ë–î –≤ .env

–ò–∑–º–µ–Ω–∏—Ç–µ `DATABASE_URL` –≤ `backend/.env`:

```env
DATABASE_URL=postgresql://user:password@localhost:5437/spa_db
```

**–í–∞–∂–Ω–æ:** –ü–æ—Ä—Ç –∏–∑–º–µ–Ω–µ–Ω —Å `5436` –Ω–∞ `5437` –≤ `docker-compose.yml`

### 2. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã

```bash
cd backend
docker compose down
docker compose up -d
```

### 3. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Webhook –≤ YClients (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ YClients: **–ù–∞—Å—Ç—Ä–æ–π–∫–∏ ‚Üí –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ ‚Üí Webhooks**
2. –ù–∞–∂–º–∏—Ç–µ **"–î–æ–±–∞–≤–∏—Ç—å URL"**
3. –£–∫–∞–∂–∏—Ç–µ URL: `https://–≤–∞—à-–¥–æ–º–µ–Ω.com/api/v1/yclients/webhook`
   - –î–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å ngrok: `https://–≤–∞—à-ngrok-url.ngrok.io/api/v1/yclients/webhook`
4. –í—ã–±–µ—Ä–∏—Ç–µ —Å–æ–±—ã—Ç–∏—è:
   - ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏
   - ‚úÖ –ò–∑–º–µ–Ω–µ–Ω–∏–µ –∑–∞–ø–∏—Å–∏
   - ‚úÖ –û—Ç–º–µ–Ω–∞ –∑–∞–ø–∏—Å–∏
5. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ

### 4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –ë–î, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:

```bash
cd backend
python scripts/check_booking_sync.py
```

–°–∫—Ä–∏–ø—Ç –ø–æ–∫–∞–∂–µ—Ç:
- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ YClients
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π –≤ –ë–î
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –∫–æ–¥–∞–º–∏
- –ü–æ—Å–ª–µ–¥–Ω–∏–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∏

### 5. –†—É—á–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)

```bash
curl -X POST "http://localhost:9003/api/v1/yclients/sync-bookings" \
  -H "Authorization: Bearer YOUR_TOKEN"
```

## üîÑ –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–∑–¥–∞–µ—Ç –∑–∞–ø–∏—Å—å —á–µ—Ä–µ–∑ —Ñ–æ—Ä–º—É YClients**
   - –í –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è: `"–ö–æ–¥ –∫–ª–∏–µ–Ω—Ç–∞: ABC12345"`

2. **YClients –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç webhook** (–µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω)
   - –°–∏—Å—Ç–µ–º–∞ –ø–æ–ª—É—á–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
   - –ù–∞—Ö–æ–¥–∏—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ –∫–æ–¥—É
   - –°–æ–∑–¥–∞–µ—Ç –∑–∞–ø–∏—Å—å –≤ –ë–î

3. **–ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è** (–∫–∞–∂–¥—ã–µ 30 –º–∏–Ω—É—Ç)
   - –ü–æ–ª—É—á–∞–µ—Ç –≤—Å–µ –∑–∞–ø–∏—Å–∏ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 30 –¥–Ω–µ–π
   - –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç —Å –ë–î
   - –ù–∞—á–∏—Å–ª—è–µ—Ç –±–æ–Ω—É—Å—ã –∑–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∏

4. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç —Å–≤–æ–∏ –∑–∞–ø–∏—Å–∏**
   - –í –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ —á–µ—Ä–µ–∑ `GET /api/v1/booking?upcoming_only=true`
   - –í –∞–¥–º–∏–Ω –ø–∞–Ω–µ–ª–∏ —á–µ—Ä–µ–∑ –ø–æ–∏—Å–∫ –ø–æ –∫–æ–¥—É

## üìù –í–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã

- ‚úÖ –í—Å–µ –∑–∞–ø–∏—Å–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –ª–æ–∫–∞–ª—å–Ω—É—é –ë–î
- ‚úÖ –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∫–æ–¥ - —Å–∞–º—ã–π –Ω–∞–¥–µ–∂–Ω—ã–π —Å–ø–æ—Å–æ–± –ø—Ä–∏–≤—è–∑–∫–∏
- ‚úÖ Webhook + –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è - –¥–≤–æ–π–Ω–∞—è –≥–∞—Ä–∞–Ω—Ç–∏—è
- ‚úÖ –ë–æ–Ω—É—Å—ã –Ω–∞—á–∏—Å–ª—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –∑–∞–ø–∏—Å–∏
- ‚úÖ –°–ø–∏—Å–∞–Ω–∏–µ –±–æ–Ω—É—Å–æ–≤ –ø–æ –∫–æ–¥—É —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –∞–¥–º–∏–Ω –ø–∞–Ω–µ–ª–∏

## üêõ Troubleshooting

### –ó–∞–ø–∏—Å–∏ –Ω–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É—é—Ç—Å—è

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ YClients –≤ `.env`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –±—ç–∫–µ–Ω–¥–∞
3. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ webhook –Ω–∞—Å—Ç—Ä–æ–µ–Ω –≤ YClients
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –≤—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –∏–º–µ—é—Ç `unique_code`

### –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –≤ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∑–∞–ø–∏—Å–∏ –µ—Å—Ç—å `"–ö–æ–¥ –∫–ª–∏–µ–Ω—Ç–∞: ..."`
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ email/—Ç–µ–ª–µ—Ñ–æ–Ω —Å–æ–≤–ø–∞–¥–∞—é—Ç
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –∑–∞–ø—É—â–µ–Ω—ã: `docker compose ps`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ—Ä—Ç –≤ `.env` (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å `5437`)
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ PostgreSQL: `docker compose logs postgres`


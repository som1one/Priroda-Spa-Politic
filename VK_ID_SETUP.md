# Настройка входа через VK ID

## Шаги настройки

### 1. Получение VK App ID и Secret Key

1. Перейдите на https://id.vk.com/business
2. Создайте новое приложение или выберите существующее
3. Получите:
   - **App ID** (идентификатор приложения)
   - **Secret Key** (секретный ключ)

### 2. Настройка бэкенда

Добавьте в `backend/.env`:

```env
VK_APP_ID=ваш_app_id
VK_SECRET_KEY=ваш_secret_key
```

### 3. Настройка Flutter приложения

Добавьте VK App ID в константы или используйте переменную окружения:

**Вариант 1: Через переменную окружения (рекомендуется)**

При запуске приложения:
```bash
flutter run --dart-define=VK_APP_ID=ваш_app_id
```

**Вариант 2: Прямо в коде (не рекомендуется для продакшена)**

Отредактируйте `spa/lib/utils/constants.dart`:
```dart
static const String vkAppId = 'ваш_app_id';
```

### 4. Настройка Redirect URI

В настройках приложения VK добавьте redirect URI:
```
https://oauth.vk.com/blank.html
```

Это стандартный redirect URI для мобильных приложений VK ID.

### 5. Проверка работы

1. Запустите приложение
2. На экране регистрации нажмите "Войти с помощью VK"
3. Откроется WebView с авторизацией VK
4. После успешной авторизации вы будете перенаправлены в приложение

## Архитектура

### Backend (`/auth/vk`)

1. Принимает `access_token`, `user_id`, `email`, `first_name`, `last_name`, `photo_url`
2. Проверяет токен через VK API (`users.get`)
3. Создает или обновляет пользователя в БД
4. Возвращает JWT токен для приложения

### Flutter

1. `VkAuthScreen` открывает WebView с OAuth страницей VK
2. После авторизации VK возвращает redirect с токеном в fragment
3. Извлекаем `access_token`, `user_id`, `email` из URL
4. Запрашиваем дополнительную информацию через VK API (`users.get`)
5. Отправляем все данные на бэкенд `/auth/vk`
6. Получаем JWT токен и сохраняем его
7. Перенаправляем на главный экран

## Безопасность

- Токен VK проверяется на бэкенде через VK API
- User ID проверяется на соответствие токену
- Секретный ключ хранится только на бэкенде
- JWT токены используются для дальнейшей авторизации

## Troubleshooting

### Ошибка "VK App ID не настроен"
- Убедитесь, что `VK_APP_ID` установлен в константах или переменных окружения

### Ошибка "Неверный VK токен"
- Проверьте, что `VK_SECRET_KEY` правильно установлен в `.env`
- Убедитесь, что redirect URI совпадает в настройках VK приложения

### WebView не открывается
- Проверьте подключение к интернету
- Убедитесь, что `webview_flutter` установлен в `pubspec.yaml`

### Пользователь не создается
- Проверьте логи бэкенда
- Убедитесь, что VK API доступен с бэкенда
- Проверьте настройки БД

